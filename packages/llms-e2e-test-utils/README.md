# LifterLMS E2E Test Utilities

End-To-End (E2E) test utilities for LifterLMS (and WordPress). This package extends functionality provided by [@wordpress/e2e-test-utils](https://github.com/WordPress/gutenberg/tree/master/packages/e2e-test-utils), adding functionality specifically for testing LifterLMS projects and add-ons.

## Installation

Install the module

```bash
npm install --save-dev @lifterlms/llms-e2e-test-utils`
```

## Changelog

[View the Changelog](./CHANGELOG.md)

## API Docs

<!-- START TOKEN(Autogenerated API docs) -->

### activateTheme

Activates a theme.

_Parameters_

-   _theme_ `?string`: Accepts a theme slug. If not supplied, loads the default theme for the tested WP version.

_Returns_

-   `Promise`: Promise that resolves when the theme is activated.

### clearBlocks

Deletes all blocks in the editor.

_Returns_

-   `Promise`: Promise from page.evaluate().

### click

Click an elements by selector

_Parameters_

-   _selector_ `string`: Element selector string.

_Returns_

-   `void`: 

### clickAndWait

Click an element and wait for navigation.

_Parameters_

-   _selector_ `string`: Query selector for the DOM element to click.
-   _waitUntil_ `string`: Network connection to wait for, defaults to 'networkidle2'.

_Returns_

-   `void`: 

### clickElementByText

Click an element by Text

_Parameters_

-   _string_ `string`: Case-insensitive string to search.
-   _selector_ `string`: Selector to search. Default "\*".

_Returns_

-   `void`: 

### createAccessPlan

Create and publish a new course

_Parameters_

-   _args_ `Object`: Creation arguments.
-   _args.postId_ `number`: Post ID of the plan's course or membership.
-   _args.price_ `number`: Plan price.
-   _args.title_ `string`: Plan title.

_Returns_

-   `string`: The created plan's purchase link URL.

### createCertificate

Create and publish a new certificate

_Type_

-   `number`certificateId    WP Post ID of the created certificate post.
-   `number`engagementId    WP Post ID of the created engagement post. }

_Parameters_

-   _args_ `Object`: Optional creation arguments.
-   _args.title_ `string`: Certificate title.
-   _args.content_ `string`: HTML content of the certificate.
-   _args.adminTitle_ `string`: Admin title.
-   _args.engagement_ `string`: If supplied, also creates an engagement trigger. This should be the ID of a trigger

_Returns_

-   `Object`: { Object containing information about the created post(s).

### createCoupon

Create and publish a new course

_Parameters_

-   _args_ `Object`: Creation arguments.
-   _args.code_ `string`: Coupon code (post title).
-   _args.discount_ `string`: The discount amount with either a leading `$` to specify dollar amount discounts or a trailing `%` for percentage discounts.

_Returns_

-   `string`: The coupon code.

### createCourse

Create and publish a new course

_Parameters_

-   _title_ `string`: Course title.

_Returns_

-   `number`: The created course's WP_Post ID.

### createEngagement

Create and publish a new certificate

_Parameters_

-   _engagementId_ `number`: WP_Post ID of the a certificate, email, or achievement post.
-   _args_ `Object`: Optional creation arguments.
-   _args.title_ `string`: Engagement title.
-   _args.trigger_ `string`: ID of the engagement trigger event.
-   _args.type_ `string`: Engagement type: certificate, email, or achievement.
-   _args.delay_ `number`: Engagement delay, in days.

_Returns_

-   `number`: WP Post ID of the created certificate post.

### createMembership

Create and publish a new membership

_Parameters_

-   _title_ `string`: Membership title.

_Returns_

-   `number`: The created membership's WP_Post ID.

### createPost

Create and publish a new post

_Parameters_

-   _postType_ `string`: WP_Post type.
-   _title_ `string`: Post title.
-   _content_ `?string`: Post content.

_Returns_

-   `number`: The created post's WP_Post ID.

### createUser

Create a new user.

_Parameters_

-   _opts_ `Object`: Hash of user information used to create the new user.

_Returns_

-   `Object`: Object of created user data.

### createVoucher

Create and publish a new course

_Parameters_

-   _args_ `Object`: Creation arguments.
-   _args.name_ `string`: Voucher (post) title.
-   _args.course_ `string`: Name of a course to add to the voucher.
-   _args.membership_ `string`: Name of a membership to add to the voucher.
-   _args.codes_ `number`: Number of codes to generate.
-   _args.uses_ `number`: Number of uses per code.

_Returns_

-   `string[]`: Array of the generated voucher codes.

### dismissEditorWelcomeGuide

Dismiss the "Welcome Guide" in the block editor (if it's active)

_Returns_

-   `void`: 

### enrollStudent

Enroll a student into a course

This performs as "manual" enrollment using the enrollment
area on the course or membership.

_Parameters_

-   _postId_ `number`: WP_Post ID.
-   _studentId_ `number`: WP_User ID.

_Returns_

-   `void`: 

### fillField

Type text into a field identified by a selector.

_Parameters_

-   _selector_ `string`: Query selector to identify the field element.
-   _text_ `string`: Text to type into the field.

_Returns_

-   `void`: 

### findElementByText

Find an element by Text

_Related_

-

_Parameters_

-   _string_ `string`: Case-insensitive string to search.
-   _selector_ `string`: Selector to search. Default "\*".

_Returns_

-   `Array`: Element.

### getAllBlocks

Retrieves a list of blocks in the editor, with or without client IDs.

Specifying `withClientIds=false` allows using the resulting array of block
objects in snapshots without having to specify a snapshot matcher
that excludes (possibly nested) blocks with clientIds that will not
match future test runs.

_Parameters_

-   _withClientIds_ `boolean`: Whether or not to exclude clientIds.

_Returns_

-   `Object[]`: Array of block objects.

### getPostTitleSelector

Retrieves the CSS selector for the post's title element.

On 5.9+ we're testing against the 2022 theme, on 5.8 & earlier we're using 2021.

_Returns_

-   `Promise`: A promise that resolves to return the element's text content.

### getPostTitleTextContent

Retrieves the textContent of the lesson post's title element.

This function uses a dynamically-determined selector based on the current WP version (and assumed theme)
run by default with that version.

_Returns_

-   `Promise`: A promise that resolves to return the element's text content.

### getWPVersion

Retrieve the WP_VERSION environment variable

When running tests locally this will likely be undefined unless running tests with
`WP_VERSION=5.7.2 npm run test`.

The WP_VERSION env var is defined during CI tests automatically and this function
is generally used to determine conditionals based on the WP Core version.

For example: block editor selectors change between WP core version, some features
aren't available on older versions, etc...

_Returns_

-   `?string`: WordPress version or null if not set.

### highlightNode

Highlight (selects) the contents of a node.

_Parameters_

-   _selector_ `string`: Query selector.
-   _copySelection_ `boolean`: If `true`, copies the selected text and returns it. The browser clipboard-read permission must be granted in order to read from the clipboard.

_Returns_

-   `boolean|string`: Returns the copied text or `true` if `copySelection` is `false`.

### importCourse

Import a course JSON file

_Parameters_

-   _importFile_ `string`: Filename of the import.
-   _importPath_ `string`: Local path where the file is located. By default uses `tests/assets/`.
-   _navigate_ `boolean`: Whether or not to automatically navigate to the imported course when done.

_Returns_

-   `void`: 

### loginStudent

Login a user via the LifterLMS student dashboard.

_Parameters_

-   _login_ `string`: User login or email address.
-   _pass_ `string`: User password.

_Returns_

-   `void`: 

### logoutUser

Logout the current user.

_Returns_

-   `Promise`: Promise which resolves after the user is logged out and the page reloaded.

### openSidebarPanelTab

Opens a sidebar panel tab if it's not already open.

_Parameters_

-   _tab_ `string`: Tab to select, accepts "primary" to select the main document settings tab or "block" to select the block tab.

_Returns_

-   `Promise`: A promise that resolves when the desired panel becomes active.

### publishPost

Disables prepublish checks and clicks the post publish button.

_Returns_

-   `Promise`: Promise which resolves when the close button element is successfully clicked.

### registerStudent

Register a new student via the LifterLMS Open Registration Page

_Type_

-   `string`email     User's email address.
-   `string`pass     User's password. }

_Parameters_

-   _args_ `Object`: Function arguments object.
-   _args.email_ `string`: Email address. If not supplied one will be created from the first name and last name.
-   _args.pass_ `string`: User password. If not supplied one will be automatically generated.
-   _args.first_ `string`: User's first name.
-   _args.last_ `string`: User's last name.
-   _args.voucher_ `string`: Voucher code to use during registration.
-   _args.address1_ `string`: User's address line 1.
-   _args.address2_ `string`: User's address line 2.
-   _args.city_ `string`: User's city.
-   _args.country_ `string`: User's country.
-   _args.state_ `string`: User's state.
-   _args.postcode_ `string`: User's postcode.
-   _args.phone_ `string`: User's phone.

_Returns_

-   `Object`: { Object containing information about the newly created user.

### runSetupWizard

Run (and test) the LifterLMS Setup Wizard

_Parameters_

-   _options_ `Object`: Options object.
-   _options.coursesToImport_ `string[]`: Titles of the course(s) to import through the setup wizard. Pass a falsy to skip import and "Start from Scratch".
-   _options.exit_ `boolean`: Whether or not to exit the setup wizard at the conclusion of setup. If `true`, uses the "Exit" link to leave setup.\`

_Returns_

-   `void`: 

### select2Select

Select a value from a select2 dropdown field

_Parameters_

-   _selector_ `string`: Query selector for the select element.
-   _value_ `string`: Option value to select.

_Returns_

-   `void`: 

### setCheckboxSetting

Toggles a LifterLMS checkbox setting.

_Parameters_

-   _selector_ `string`: Selector for the setting checkbox.
-   _status_ `boolean`: Requested setting status. Use `true` for checked and `false` for unchecked.
-   _save_ `boolean`: Whether or not to perform a save after updating the setting.

_Returns_

-   `void`: 

### setSelect2Option

Set the value of a select2 dropdown field

This does not actually test whether or not select2 is working,
instead it selects the value on the select element and artificially
triggers a change event.

_Parameters_

-   _selector_ `string`: Query selector for the select element.
-   _value_ `string`: Option value to select.
-   _create_ `boolean`: If `true`, the value will be added to the select element before being selected. This is a useful option for AJAX powered select2 elements that will be empty until interacted with.

_Returns_

-   `void`: 

### toggleOpenRegistration

Toggles the open registration setting on or off

_Parameters_

-   _status_ `boolean`: Whether to toggle on (`true`) or off (`false`).

_Returns_

-   `void`: 

### toggleSidebarPanel

Opens or closes an editor sidebar panel based on the panel's title.

_Parameters_

-   _title_ `string`: The panel title to open or close.
-   _shouldBeOpen_ `boolean`: Whether or not the panel should be open.

_Returns_

-   `Object|undefined`: A puppeteer ElementHandle object if found.

### updatePost

Clicks the button to save / update a post in the block editor.

_Returns_

-   `Promise`: A promise that resolves when the button is successfully pressed.

### visitPage

Visits a page on the WordPress site.

_Parameters_

-   _path_ `string`: URL path. Eg: "dashboard" to visit mysite.com/dashboard.
-   _query_ `string`: Query string to be added to the url. Eg: "myvar=1&anothervar=2".

_Returns_

-   `void`: 

### visitPostPermalink

Visits a post on the frontend by from within the block editor.

_Returns_

-   `Promise`: A promise representing the link click.

### visitSettingsPage

Visit a LifterLMS Settings Page on the admin panel

_Parameters_

-   _args_ `Object`: Arguments object.
-   _args.tab_ `string`: Settings page tab ID.
-   _args.section_ `string`: Settings page section ID.

_Returns_

-   `void`: 

### wpVersionCompare

Run a version compare against the currently tested version of WordPress.

_Parameters_

-   _version_ `string`: A version string.
-   _comparator_ `string`: A comparison string, eg ">=" or "\<", etc...
-   _majorMinorOnly_ `boolean`: If `true`, only uses the major and minor versions of the current WP version. For example, version 5.9.1 will be shortened to 5.9 for comparison purposes.

_Returns_

-   `boolean`: Comparison result.


<!-- END TOKEN(Autogenerated API docs) -->
